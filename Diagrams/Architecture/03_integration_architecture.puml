@startuml 03_integration_architecture
!theme plain
skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle

title RALO System - Integration Architecture

package "External Systems" #FFE0E0 {
  component [HuggingFace Datasets] as HF
  component [WandB] as WandB
  component [File System] as FS
}

package "RALO System" #E0E0FF {
  package "Orchestrator" #C8E6C9 {
    component [OrchestratorServer] as Orch {
      component [ProblemProvider]
      component [SampleQueueManager]
      component [GradientAggregator]
      component [HTTP Server]
    }
    component [Weight Storage] as WS
    component [Gradient Storage] as GS
    component [ExperimentLogger] as Logger
  }
  
  package "Sampler Cluster" #FFF9C4 {
    component [Sampler 1] as S1
    component [Sampler 2] as S2
    component [Sampler N] as SN
  }
  
  package "Trainer Cluster" #FFCCBC {
    component [Trainer Node 1] as T1
    component [Trainer Node 2] as T2
  }
  
  package "RALO Coordinator" #E1BEE7 {
    component [RALO] as RALO
    component [Config Manager] as Config
  }
}

package "Infrastructure" #F0F0F0 {
  component [HTTP Network] as Network
  component [NCCL] as NCCL
  component [CUDA] as CUDA
  component [vLLM Runtime] as vLLMRuntime
  component [PyTorch Runtime] as PyTorch
}

' External integrations
HF --> Orch : "Problem dataset loading"
FS --> WS : "Weight file I/O"
FS --> GS : "Gradient file I/O"
WandB <--> Logger : "Metrics logging"

' Internal integrations
RALO --> Orch : "HTTP API"
RALO --> S1 : "Process spawn"
RALO --> S2 : "Process spawn"
RALO --> SN : "Process spawn"
RALO --> T1 : "Process spawn"
RALO --> T2 : "Process spawn"

S1 --> Network : "HTTP requests"
S2 --> Network : "HTTP requests"
SN --> Network : "HTTP requests"
T1 --> Network : "HTTP requests"
T2 --> Network : "HTTP requests"
Network --> Orch : "HTTP responses"

T1 --> NCCL : "AllReduce"
T2 --> NCCL : "AllReduce"
NCCL --> CUDA : "GPU communication"

S1 --> vLLMRuntime : "Inference"
S2 --> vLLMRuntime : "Inference"
SN --> vLLMRuntime : "Inference"
vLLMRuntime --> CUDA : "GPU operations"

T1 --> PyTorch : "Training"
T2 --> PyTorch : "Training"
PyTorch --> CUDA : "GPU operations"

Orch --> WS : "Weight I/O"
Orch --> GS : "Gradient I/O"
Orch --> Logger : "Logging"

Config --> RALO : "Configuration"
Config --> Orch : "Configuration"
Config --> S1 : "Configuration"
Config --> T1 : "Configuration"

note right of "External Systems"
  External integrations:
  - HuggingFace for datasets
  - WandB for experiment tracking
  - File system for persistence
end note

note right of "RALO System"
  Core system components:
  - Central orchestrator
  - Distributed workers
  - Coordination layer
end note

note right of "Infrastructure"
  Infrastructure services:
  - Network communication
  - GPU runtime
  - Distributed training
  - Inference engine
end note

@enduml

